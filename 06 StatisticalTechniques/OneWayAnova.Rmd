---
title: "One-Way Anova"
date: "Last Updated: `r format(Sys.time(), '%d, %B, %Y at %H:%M')`"
output:
  github_document:
    html_preview: true
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(reshape)
```

# Fake data

## Make some population data

```{r}
sample_size <- 15

population1 <- rnorm(100000, mean = 7.5, sd = 2)
population2 <- rnorm(100000, mean = 10, sd = 2)
population3 <- rnorm(100000, mean = 6, sd = 2)

hist(population1, breaks=100, col=rgb(1,0,0,0.2), main='', xlab = 'Penguin Weight')
hist(population2, breaks=100,  add=TRUE, col=rgb(0,1,0,0.2))
hist(population3, breaks=100,  add=TRUE, col=rgb(0,0,1,0.2))
title('Populations 1, 2, and 3')
```

## Sample from the populations

```{r}


france <- sample(population1, sample_size)
senegal <- sample(population2, sample_size)
japan <- sample(population3, sample_size)

hist(france, breaks=100, col=rgb(1,0,0,0.2), main='', xlab='Penguin Weight')
hist(senegal, breaks=100,  add=TRUE, col=rgb(0,1,0,0.2))
hist(japan, breaks=100,  add=TRUE, col=rgb(0,0,1,0.2))
title('Samples 1, 2, and 3')

data <-data.frame(cbind(france,senegal,japan))
data<-melt(data, id.vars=c())
colnames(data) <- c('sample', 'weight')
data$sample<-factor(data$sample)
head(data)
tail(data)
```

```{r}
boxplot(weight ~ sample, data = data)
```

## Run classic ANOVA

```{r}
result <- aov(weight ~ sample, data = data)
summary(result)
```

## Run LM

```{r}
result <- lm(weight ~ sample, data = data)
summary(result)
```

## Change contrasts

### Helmert coding

Here, I use Helmert coding (from R). Helmert coding compares each level of a categorical variable to the mean of the subsequent levels.

Compare this to the slides.

```{r}
contrasts(data$sample) <- contr.helmert(n = 3)
result <- lm(weight ~ sample, data = data)
summary(result)
```
```{r}
data
model.matrix(result)
```


### Compare with data

```{r}
# Fitted coefficients
result$coefficients
```


```{r}


all_data <- c(france, senegal, japan)
grand_mean <- mean(all_data)
mean_france <- mean(france)
mean_senegal <- mean(senegal)
mean_japan <- mean(japan)

c(grand_mean, mean_france, mean_senegal, mean_japan)
```

In the Helmert coding (The R version)...

+  The intercept is the grand mean
+  Beta1 is 0.5 X the difference between France and Senegal
+  Beta2 is 1/3 X the difference between Japan and the mean of Senegal and France

```{r}
intercept <- grand_mean
beta1 <- (mean_senegal - mean_france) / 2
beta2 <- (mean_japan - (mean_senegal + mean_france) / 2) / 3
c(intercept, beta1, beta2)

result$coefficients
```


### Faux

```{r}
library(faux)
helmert <- contr_code_helmert(c(1,2,3))
helmert <- contrasts(helmert)

contrasts(data$sample)  <- helmert

result <- lm(weight ~ sample, data = data)
summary(result)
c(grand_mean, mean_france, mean_senegal, mean_japan)
```




# Real data: feet

```{r}
library(tidyverse)
feet <- read_csv('data/feet.csv')
head(feet)
```

```{r}
model <- lm(FootLength ~ Sex, data = feet)
summary(model)
```

```{r}
boxplot(FootLength ~ Sex, data = feet)
```

# Real data: flies (A warning!)

<http://jse.amstat.org/datasets/fruitfly.txt>

```{r}
flies <- read_csv('data/flies.csv')
head(flies)

# Don't do this!!
model <- lm(LONGEVITY ~ TYPE, data = flies)
summary(model)
## Do this!!
model <- lm(LONGEVITY ~ as.factor(TYPE), data = flies)
summary(model)
```

```{r}
boxplot(LONGEVITY ~ TYPE, data = flies)
```

